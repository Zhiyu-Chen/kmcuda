cmake_minimum_required(VERSION 3.5)
project(KMCUDA)
find_package(OpenMP REQUIRED)
find_package(CUDA QUIET REQUIRED)
find_package(PythonLibs 3 REQUIRED)

#set(CMAKE_VERBOSE_MAKEFILE on)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -march=native -Wall -Werror -std=c++11 ${OpenMP_CXX_FLAGS}")
set(SOURCE_FILES kmcuda.cpp kmcuda.h wrappers.h private.h python.cpp kernel.cu)
if (CMAKE_BUILD_TYPE STREQUAL "Debug")
  set(NVCC_FLAGS "-G -g")
endif()
set(NVCC_FLAGS "${NVCC_FLAGS} -arch sm_52 -Xptxas=-v -D_MWAITXINTRIN_H_INCLUDED -D_FORCE_INLINES")
CUDA_ADD_LIBRARY(KMCUDA SHARED ${SOURCE_FILES} OPTIONS ${NVCC_FLAGS})
if(PYTHONLIBS_FOUND)
  include_directories(${PYTHON_INCLUDE_DIRS})
  target_link_libraries(KMCUDA ${PYTHON_LIBRARIES})
endif()